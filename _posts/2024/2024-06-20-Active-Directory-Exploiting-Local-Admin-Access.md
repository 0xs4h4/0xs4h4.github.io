---
title: Active Directory (AD) | Exploiting Local Admin Access 
author: beardenx
date: 2024-07-01 00:00:00 +0800
categories: [Cert, CRTP]
tags: [cert,active directory]     ## TAG names should always be lowercase
render_with_liquid: false
description: This topic covers the steps and techniques involved in leveraging local administrator access on machines
---

## **Step 1: Check for Privilege Escalation Paths**
**Tools Used:** PowerView. This step ensures you can escalate your privileges on the current machine to gain local admin rights. Start by checking for any privilege escalation paths. If any services can be abused, add your domain user to the local admin group.

The Invoke-AllChecks function gathers information on the Active Directory environment, accessible network shares, local administrators, active user sessions, domain trust relationships, and services permissions to aid in network reconnaissance

```bash
Invoke-AllChecks
```
![Result](/img/crtp/result1.png){: width="972" height="589" }
_Invoke-AllChecks_

## **Step 2: Abusing Services**
**Tools Used:** PowerView. After running Step 1, you will have identified a few services that can be abused. We can exploit these services to add our current domain user to the local Administrators group. 

Adding a user to the local Administrators group allows them to perform administrative tasks such as installing software, changing system settings, and accessing all files on the system, which can be crucial for further exploitation and maintaining control over the machine.

```bash
Invoke-ServiceAbuse
Invoke-ServiceAbuse -Name 'AbyssWebServer' -UserName 'dcorp\studentx' -Verbose
```

![Result](/img/crtp/result2.png){: width="972" height="589" }
_Now, our user is a local admin !_


## **Step 3: Identifying Additional Machines for Local Admin Access**

**Tools Used:** Find-PSRemotingLocalAdminAccess.ps1. After gaining local admin rights on one machine, identifying other machines where you have local admin access helps in expanding your control over the network. This can give you access to more resources, data, or higher-privilege accounts. So, you have to identify any computers/machines in the domain where our user has local administrative access.

```bash
Find-PSRemotingLocalAdminAccess
```
![Result](/img/crtp/result3.png){: width="972" height="589" }
_studentx has administrative access on dcorp-adminsrv and on the student machine_

## **Step 4: Exploiting Remote Access**

After identifying machines with local admin access, we can remotely connect using tools like winrs and PowerShell Remoting (Enter-PSSession) because local admin rights grant us the necessary permissions to access and control these machines remotely over the network.

### winrs Remoting
```bash
winrs -r:dcorp-adminsrv cmd
set username
set computername
```
![Result](/img/crtp/result4.png){: width="972" height="589" }

### PowerShell Remoting
```bash
Enter-PSSession -ComputerName dcorp-adminsrv.dollarcorp.moneycorp.local
```
![Result](/img/crtp/result5.png){: width="972" height="589" }

## **Step 3: Identify Machines with Domain Admin Sessions**

**Tools Used:** PowerView

After gaining local admin access on multiple machines, the next objective is often to escalate to **domain admin** privileges. Identifying machines where domain admin accounts are actively logged in provides an opportunity to steal their tokens and elevate privileges within the domain.